{"version":3,"sources":["transformers.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;4BAA4B,kBAAkB;;IAAlC,UAAU;;sBACH,QAAQ;;IAAf,CAAC;;wBACQ,UAAU;;;;AAExB,SAAS,WAAW,GAAG;AAC5B,MAAI,IAAI,GAAG,EAAE,CAAA;AACb,SAAO,2BAAS,UAAU,KAAK,EAAE,GAAG,EAAE,EAAE,EAAE;AACxC,QAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAA;AAChB,MAAE,EAAE,CAAA;GACL,EAAE,UAAU,EAAE,EAAE;AACf,QAAI,IAAI,CAAC,MAAM,EAAE;AACf,UAAI,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAA;KAC/B;AACD,QAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;AACf,MAAE,EAAE,CAAA;GACL,CAAC,CAAA;CACH;;AAEM,SAAS,mBAAmB,GAAG;AACpC,SAAO,sBAAS,GAAG,CAAC,UAAS,KAAK,EAAE,GAAG,EAAE,EAAE,EAAE;AAC3C,MAAE,CAAC,IAAI,EAAE,KAAK,CAAC,CAAA;GAChB,EAAE,UAAS,EAAE,EAAE;AACd,QAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;AACf,MAAE,EAAE,CAAA;GACL,CAAC,CAAA;CACH;;AAEM,SAAS,mBAAmB,CAAC,QAAQ,EAAE,gBAAgB,EAAE;AAC9D,MAAI,SAAS,GAAG,QAAQ,CAAC,WAAW,GAAG,QAAQ,CAAC,SAAS,CAAC,kBAAkB,CAAC,GAAG,IAAI,CAAA;AACpF,MAAI,UAAU,GAAG,QAAQ,CAAC,UAAU,CAAA;AACpC,MAAI,CAAC,GAAG,EAAE,CAAA;AACV,GAAC,CAAC,SAAS,GAAG,SAAS,CAAA;AACvB,MAAI,gBAAgB,IAAI,UAAU,KAAK,GAAG,EAAE;;AAE1C,cAAU,GAAG,GAAG,CAAA;GACjB;AACD,MAAI,UAAU,KAAK,GAAG,EAAE;AACtB,KAAC,CAAC,IAAI,GAAG,kBAAkB,CAAA;AAC3B,KAAC,CAAC,OAAO,GAAG,mBAAmB,CAAA;GAChC,MAAM,IAAI,UAAU,KAAK,GAAG,EAAE;AAC7B,KAAC,CAAC,IAAI,GAAG,mBAAmB,CAAA;AAC5B,KAAC,CAAC,OAAO,GAAG,yCAAyC,CAAA;GACtD,MAAM,IAAI,UAAU,KAAK,GAAG,EAAE;AAC7B,KAAC,CAAC,IAAI,GAAG,cAAc,CAAA;AACvB,KAAC,CAAC,OAAO,GAAG,2CAA2C,CAAA;GACxD,MAAM,IAAI,UAAU,KAAK,GAAG,EAAE;AAC7B,KAAC,CAAC,IAAI,GAAG,UAAU,CAAA;AACnB,KAAC,CAAC,OAAO,GAAG,WAAW,CAAA;GACxB,MAAM,IAAI,UAAU,KAAK,GAAG,EAAE;AAC7B,KAAC,CAAC,IAAI,GAAG,kBAAkB,CAAA;AAC3B,KAAC,CAAC,OAAO,GAAG,oBAAoB,CAAA;GACjC,MAAM,IAAI,UAAU,KAAK,GAAG,EAAE;AAC7B,KAAC,CAAC,IAAI,GAAG,kBAAkB,CAAA;AAC3B,KAAC,CAAC,OAAO,GAAG,oBAAoB,CAAA;GACjC,MAAM;AACL,KAAC,CAAC,IAAI,GAAG,cAAc,CAAA;AACvB,KAAC,CAAC,OAAO,QAAM,UAAU,AAAE,CAAA;GAC5B;;AAED,SAAO,sBAAS,GAAG,CAAC,UAAS,QAAQ,EAAE,GAAG,EAAE,EAAE,EAAE;AAC9C,KAAC,GAAG,CAAC,CAAC,KAAK,CAAC,CAAC,EAAE,UAAU,CAAC,UAAU,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAA;AAC1D,MAAE,EAAE,CAAA;GACL,EAAE,UAAS,EAAE,EAAE;AACd,MAAE,CAAC,CAAC,CAAC,CAAA;AACL,QAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;GAChB,CAAC,CAAA;CACH;;AAEM,SAAS,wBAAwB,GAAG;AACzC,SAAO,sBAAS,GAAG,CAAC,UAAS,QAAQ,EAAE,GAAG,EAAE,EAAE,EAAE;;;AAC9C,QAAI,OAAO,GAAG,UAAU,CAAC,eAAe,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,CAAA;AAC7D,WAAO,CAAC,OAAO,CAAC,UAAC,MAAM;aAAK,MAAK,IAAI,CAAC,MAAM,CAAC;KAAA,CAAC,CAAA;AAC9C,MAAE,EAAE,CAAA;GACL,EAAE,UAAS,EAAE,EAAE;AACd,QAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;AACf,MAAE,EAAE,CAAA;GACL,CAAC,CAAA;CACH;;AAEM,SAAS,2BAA2B,GAAG;AAC5C,SAAO,sBAAS,GAAG,CAAC,UAAS,QAAQ,EAAE,GAAG,EAAE,EAAE,EAAE;AAC9C,QAAI,CAAC,IAAI,CAAC,UAAU,CAAC,kBAAkB,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAA;AAC7D,MAAE,EAAE,CAAA;GACL,EAAE,UAAS,EAAE,EAAE;AACd,QAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;AACf,MAAE,EAAE,CAAA;GACL,CAAC,CAAA;CACH;;AAEM,SAAS,uBAAuB,GAAG;AACxC,SAAO,sBAAS,GAAG,CAAC,UAAS,QAAQ,EAAE,GAAG,EAAE,EAAE,EAAE;AAC9C,QAAI,CAAC,IAAI,CAAC,UAAU,CAAC,cAAc,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAA;AACzD,MAAE,EAAE,CAAA;GACL,EAAE,UAAS,EAAE,EAAE;AACd,QAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;AACf,MAAE,EAAE,CAAA;GACL,CAAC,CAAA;CACH;;AAEM,SAAS,iBAAiB,GAAG;AAClC,SAAO,sBAAS,GAAG,CAAC,UAAS,QAAQ,EAAE,GAAG,EAAE,EAAE,EAAE;AAC9C,QAAI,CAAC,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAA;AACnD,MAAE,EAAE,CAAA;GACL,EAAE,UAAS,EAAE,EAAE;AACd,QAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;AACf,MAAE,EAAE,CAAA;GACL,CAAC,CAAA;CACH;;AAEM,SAAS,+BAA+B,GAAG;AAChD,SAAO,sBAAS,GAAG,CAAC,UAAS,QAAQ,EAAE,GAAG,EAAE,EAAE,EAAE;AAC9C,QAAI,CAAC,IAAI,CAAC,UAAU,CAAC,sBAAsB,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAA;AACjE,MAAE,EAAE,CAAA;GACL,EAAE,UAAS,EAAE,EAAE;AACd,QAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;AACf,MAAE,EAAE,CAAA;GACL,CAAC,CAAA;CACH;;AAEM,SAAS,yBAAyB,GAAG;AAC1C,SAAO,sBAAS,GAAG,CAAC,UAAS,QAAQ,EAAE,GAAG,EAAE,EAAE,EAAE;AAC9C,QAAI,CAAC,IAAI,CAAC,UAAU,CAAC,gBAAgB,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAA;AAC3D,MAAE,EAAE,CAAA;GACL,EAAE,UAAS,EAAE,EAAE;AACd,QAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;AACf,MAAE,EAAE,CAAA;GACL,CAAC,CAAA;CACH;;AAEM,SAAS,0BAA0B,CAAC,IAAI,EAAE;AAC/C,MAAI,SAAS,GAAG,CAAC,CAAA;;;AAGjB,SAAO,sBAAS,GAAG,CAAC,UAAS,KAAK,EAAE,GAAG,EAAE,EAAE,EAAE;AAC3C,aAAS,IAAI,KAAK,CAAC,MAAM,CAAA;AACzB,QAAI,SAAS,GAAG,IAAI,EAAE;AACpB,aAAO,EAAE,CAAC,2CAA2C,CAAC,CAAA;KACvD;AACD,QAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAA;AAChB,MAAE,EAAE,CAAA;GACL,EAAE,UAAS,EAAE,EAAE;AACd,QAAI,SAAS,IAAI,IAAI,EAAE;AACrB,aAAO,EAAE,CAAC,2CAA2C,CAAC,CAAA;KACvD;AACD,QAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;AACf,MAAE,EAAE,CAAA;GACL,CAAC,CAAA;CACH;;AAEM,SAAS,+BAA+B,GAAG;AAChD,SAAO,sBAAS,GAAG,CAAC,UAAS,QAAQ,EAAE,GAAG,EAAE,EAAE,EAAE;AAC9C,QAAI,CAAC,IAAI,CAAC,UAAU,CAAC,sBAAsB,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAA;AACjE,MAAE,EAAE,CAAA;GACL,EAAE,UAAS,EAAE,EAAE;AACd,QAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;AACf,MAAE,EAAE,CAAA;GACL,CAAC,CAAA;CACH","file":"transformers.js","sourcesContent":["import * as xmlParsers from './xml-parsers.js'\nimport * as _ from 'lodash'\nimport Through2 from 'through2'\n\nexport function getConcater() {\n  var bufs = []\n  return Through2(function (chunk, enc, cb) {\n    bufs.push(chunk)\n    cb()\n  }, function (cb) {\n    if (bufs.length) {\n      this.push(Buffer.concat(bufs))\n    }\n    this.push(null)\n    cb()\n  })\n}\n\nexport function getDummyTransformer() {\n  return Through2.obj(function(chunk, enc, cb) {\n    cb(null, chunk)\n  }, function(cb) {\n    this.push(null)\n    cb()\n  })\n}\n\nexport function getErrorTransformer(response, methodListBucket) {\n  var requestid = response.headersSent ? response.getHeader('x-amz-request-id') : null\n  var statusCode = response.statusCode\n  var e = {}\n  e.requestid = requestid\n  if (methodListBucket && statusCode === 307) {\n    // ListBucket response sends 307 for unauthorized access\n    statusCode = 403\n  }\n  if (statusCode === 301) {\n    e.code = 'MovedPermanently'\n    e.message = 'Moved Permanently'\n  } else if (statusCode === 307) {\n    e.code = 'TemporaryRedirect'\n    e.message = 'Are you using the correct endpoint URL?'\n  } else if (statusCode === 403) {\n    e.code = 'AccessDenied'\n    e.message = 'Valid and authorized credentials required'\n  } else if (statusCode === 404) {\n    e.code = 'NotFound'\n    e.message = 'Not Found'\n  } else if (statusCode === 405) {\n    e.code = 'MethodNotAllowed'\n    e.message = 'Method Not Allowed'\n  } else if (statusCode === 501) {\n    e.code = 'MethodNotAllowed'\n    e.message = 'Method Not Allowed'\n  } else {\n    e.code = 'UnknownError'\n    e.message = `${statusCode}`\n  }\n\n  return Through2.obj(function(xmlbytes, enc, cb) {\n    e = _.merge(e, xmlParsers.parseError(xmlbytes.toString()))\n    cb()\n  }, function(cb) {\n    cb(e)\n    this.push(null)\n  })\n}\n\nexport function getListBucketTransformer() {\n  return Through2.obj(function(xmlbytes, enc, cb) {\n    var buckets = xmlParsers.parseListBucket(xmlbytes.toString())\n    buckets.forEach((bucket) => this.push(bucket))\n    cb()\n  }, function(cb) {\n    this.push(null)\n    cb()\n  })\n}\n\nexport function getListMultipartTransformer() {\n  return Through2.obj(function(xmlbytes, enc, cb) {\n    this.push(xmlParsers.parseListMultipart(xmlbytes.toString()))\n    cb()\n  }, function(cb) {\n    this.push(null)\n    cb()\n  })\n}\n\nexport function getListPartsTransformer() {\n  return Through2.obj(function(xmlbytes, enc, cb) {\n    this.push(xmlParsers.parseListParts(xmlbytes.toString()))\n    cb()\n  }, function(cb) {\n    this.push(null)\n    cb()\n  })\n}\n\nexport function getAclTransformer() {\n  return Through2.obj(function(xmlbytes, enc, cb) {\n    this.push(xmlParsers.parseAcl(xmlbytes.toString()))\n    cb()\n  }, function(cb) {\n    this.push(null)\n    cb()\n  })\n}\n\nexport function getInitiateMultipartTransformer() {\n  return Through2.obj(function(xmlbytes, enc, cb) {\n    this.push(xmlParsers.parseInitiateMultipart(xmlbytes.toString()))\n    cb()\n  }, function(cb) {\n    this.push(null)\n    cb()\n  })\n}\n\nexport function getListObjectsTransformer() {\n  return Through2.obj(function(xmlbytes, enc, cb) {\n    this.push(xmlParsers.parseListObjects(xmlbytes.toString()))\n    cb()\n  }, function(cb) {\n    this.push(null)\n    cb()\n  })\n}\n\nexport function getSizeVerifierTransformer(size) {\n  var totalSize = 0\n  // FIXME: cb should provide proper error object instead of string\n  // string is being passed here to satisfy test cases for now\n  return Through2.obj(function(chunk, enc, cb) {\n    totalSize += chunk.length\n    if (totalSize > size) {\n      return cb('actual size does not match specified size')\n    }\n    this.push(chunk)\n    cb()\n  }, function(cb) {\n    if (totalSize != size) {\n      return cb('actual size does not match specified size')\n    }\n    this.push(null)\n    cb()\n  })\n}\n\nexport function getCompleteMultipartTransformer() {\n  return Through2.obj(function(xmlbytes, enc, cb) {\n    this.push(xmlParsers.parseCompleteMultipart(xmlbytes.toString()))\n    cb()\n  }, function(cb) {\n    this.push(null)\n    cb()\n  })\n}\n"],"sourceRoot":"/source/"}